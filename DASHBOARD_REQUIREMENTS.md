# 대시보드 포인트 시스템 요구사항

## 📊 포인트 데이터 정의

### 1. 전체 포인트
- **정의**: 현재 남아있는 전체 포인트
- **계산**: 충전된 포인트 - 사용된 포인트
- **표시**: 메인 포인트 잔액

### 2. 이용가능 포인트
- **정의**: 실제 사용 가능한 포인트
- **계산**: 전체 포인트 - 소멸예정 포인트
- **용도**: 실제 서비스 이용 시 차감되는 포인트

### 3. 사용한 포인트
- **정의**: 누적으로 사용한 총 포인트
- **계산**: 전체 기간 사용 포인트 합계
- **표시**: 역대 총 사용량

### 4. 이번달 사용한 포인트
- **정의**: 현재 월(today 기준) 사용한 포인트
- **계산**: 당월 1일 ~ 현재까지 사용량
- **업데이트**: 매일 실시간 갱신

### 5. 소멸예상 포인트
- **정의**: 소멸예정인 포인트
- **계산**: 포인트 결제일 + 6개월 > 현재일 ? 소멸예정포인트 : 0
- **조건**: 소멸예상일이 지나면 자동으로 0으로 변경

## 📈 차트 및 통계 데이터

### 1. 사용 현황 (최근 3개월)
- **표시 항목**: 
  - 월별 사용 포인트
  - 월별 이용 건수 (새로 추가)
- **업데이트**: 매월 1일 자동 갱신
- **형식**: "포인트 (건수)" 예: "450,000P (48건)"

### 2. 구성원 현황
- **정의**: 시스템에 등록된 총 구성원 수
- **계산**: members 테이블의 총 레코드 수
- **업데이트**: 구성원 추가/삭제 시 실시간 갱신

### 3. 평균 사용 포인트
- **정의**: 최근 3개월 월평균 사용 포인트
- **계산**: (최근3개월 사용량 합계) / 3
- **업데이트**: 매월 1일 자동 갱신

### 4. 이용종목 현황
- **기간**: 최근 3개월
- **표시**: 종목별 사용 포인트 및 비율
- **종목**: 헬스, 필라테스, 요가, 크로스핏, PT, 기타
- **업데이트**: 매월 1일 자동 갱신

## 🔄 자동 업데이트 시점

### 매일 업데이트
- 이번달 사용한 포인트
- 소멸예상 포인트 (소멸일 체크)

### 매월 1일 업데이트
- 사용 현황 차트 (3개월 데이터)
- 평균 사용 포인트
- 이용종목 현황

### 실시간 업데이트
- 전체 포인트 (포인트 사용 시)
- 이용가능 포인트 (포인트 사용 시)
- 구성원 현황 (구성원 추가/삭제 시)

## 💻 구현 세부사항

### 날짜 계산
```javascript
const today = new Date();
const currentYear = today.getFullYear();
const currentMonth = today.getMonth(); // 0-11 (0=1월)
```

### 소멸일 계산
```javascript
const getExpirationDate = (chargeDate) => {
  const date = new Date(chargeDate);
  date.setMonth(date.getMonth() + 6);
  return date;
};

const isExpired = today > expirationDate;
const expiringPoints = isExpired ? 0 : originalExpiringPoints;
```

### 월별 데이터 구조
```javascript
const monthlyUsageData = [
  { 
    year: 2024, 
    month: 9,        // 0-based (9 = 10월)
    usage: 380000,   // 사용 포인트
    count: 45        // 이용 건수
  }
];
```

### API 연동 포인트
- `GET /api/points/summary` - 포인트 요약 정보
- `GET /api/usage/monthly` - 월별 사용 현황
- `GET /api/categories/recent` - 최근 3개월 종목별 현황
- `GET /api/members/count` - 구성원 수

## 🎯 주요 비즈니스 로직

1. **포인트 차감 시**: 이용가능 포인트부터 차감
2. **소멸 처리**: 매일 자정에 소멸일 체크 후 자동 소멸
3. **월 변경**: 매월 1일 자정에 통계 데이터 갱신
4. **실시간 동기화**: 포인트 사용 시 모든 관련 지표 즉시 업데이트

## 📱 사용자 경험

- 모든 숫자는 천단위 콤마 표시
- 포인트는 "P" 단위 표시
- 퍼센트는 정수로 반올림
- 소멸일은 "YYYY. MM. DD" 형식
- 실시간 데이터 반영으로 사용자 혼란 최소화







