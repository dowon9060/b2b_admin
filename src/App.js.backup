import React, { useState } from "react";
import { BrowserRouter as Router, Routes, Route, Navigate, Link, useLocation, useParams, useNavigate } from "react-router-dom";
import "./App.css";
import MemberList from "./MemberList";
import MemberDetail from "./MemberDetail";

const initialMembers = [
  { id: 1, name: "í™ê¸¸ë™", department: "ì˜ì—…", joinDate: "2022-01-01", empNo: "1001", point: 1000, phone: "010-1234-5678", email: "hong@company.com", userId: "hong@company.com" },
  { id: 2, name: "ê¹€ì² ìˆ˜", department: "ê°œë°œ", joinDate: "2021-05-10", empNo: "1002", point: 800, phone: "010-2345-6789", email: "kim@company.com", userId: "kim@company.com" },
  { id: 3, name: "ì´ì˜í¬", department: "ë””ìì¸", joinDate: "2023-03-15", empNo: "1003", point: 1200, phone: "010-3456-7890", email: "lee@company.com", userId: "lee@company.com" },
];

function LoginPage({ onLogin }) {
  const [userId, setUserId] = useState("");
  const [password, setPassword] = useState("");
  const navigate = useNavigate();
  const handleSubmit = (e) => {
    e.preventDefault();
    // ì‹¤ì œ ì¸ì¦ ë¡œì§ì€ ì¶”í›„ êµ¬í˜„
    if (userId && password) {
      onLogin();
      navigate("/");
    } else {
      alert("ì•„ì´ë””ì™€ íŒ¨ìŠ¤ì›Œë“œë¥¼ ì…ë ¥í•˜ì„¸ìš”");
    }
  };
  return (
    <div className="login-container">
      <h2>ë¡œê·¸ì¸</h2>
      <form className="login-form" onSubmit={handleSubmit}>
        <div>
          <label htmlFor="userId">ì•„ì´ë””</label>
          <input id="userId" type="text" placeholder="ì•„ì´ë”” ì…ë ¥" value={userId} onChange={e => setUserId(e.target.value)} />
        </div>
        <div>
          <label htmlFor="password">íŒ¨ìŠ¤ì›Œë“œ</label>
          <input id="password" type="password" placeholder="íŒ¨ìŠ¤ì›Œë“œ ì…ë ¥" value={password} onChange={e => setPassword(e.target.value)} />
        </div>
        <div>
          <label>
            <input type="checkbox" /> ì•„ì´ë”” ì €ì¥(ê¸°ì–µ)
          </label>
        </div>
        <button type="submit">ë¡œê·¸ì¸</button>
      </form>
    </div>
  );
}

function Dashboard() {
  const navigate = useNavigate();

  const handleCardClick = (type) => {
    if (type === 'members') {
      navigate('/members');
    } else if (type === 'settlement') {
      navigate('/settlement');
    } else if (type === 'charge') {
      navigate('/charge');
    }
  };

  // í˜„ì¬ ë‚ ì§œ ê¸°ì¤€ ê³„ì‚°
  const today = new Date();
  const currentYear = today.getFullYear();
  const currentMonth = today.getMonth(); // 0-11
  
  // êµ¬ì„±ì› ë°ì´í„° (ì‹¤ì œë¡œëŠ” members propì—ì„œ ê°€ì ¸ì˜´)
  const totalMembers = 15; // ë“±ë¡ëœ êµ¬ì„±ì› ìˆ˜
  
  // ê¸°ë³¸ í¬ì¸íŠ¸ ë°ì´í„° (ì‹¤ì œë¡œëŠ” APIì—ì„œ ê°€ì ¸ì˜´)
  const rawPointData = {
    remainingPoints: 5000000, // í˜„ì¬ ë‚¨ì•„ìˆëŠ” ì „ì²´ í¬ì¸íŠ¸
    totalUsedPoints: 1800000, // ëˆ„ì  ì‚¬ìš©í•œ í¬ì¸íŠ¸
    chargeDate: "2024-01-15", // í¬ì¸íŠ¸ ê²°ì œì¼
    monthlyUsageData: [
      { year: 2024, month: 9, usage: 380000, count: 45 }, // 10ì›” (monthëŠ” 0-based)
      { year: 2024, month: 10, usage: 420000, count: 52 }, // 11ì›”
      { year: 2024, month: 11, usage: 450000, count: 48 }, // 12ì›”
    ]
  };

  // ì†Œë©¸ì˜ˆìƒì¼ ê³„ì‚° ë° ì†Œë©¸ í¬ì¸íŠ¸ í™•ì¸
  const getExpirationDate = (chargeDate) => {
    const date = new Date(chargeDate);
    date.setMonth(date.getMonth() + 6);
    return date;
  };

  const expirationDate = getExpirationDate(rawPointData.chargeDate);
  const isExpired = today > expirationDate;
  const expiringPoints = isExpired ? 0 : 150000; // ì†Œë©¸ì˜ˆìƒì¼ ì§€ë‚˜ë©´ 0

  // ì´ë²ˆë‹¬ ì‚¬ìš©í•œ í¬ì¸íŠ¸ (í˜„ì¬ ì›” ê¸°ì¤€)
  const thisMonthUsage = rawPointData.monthlyUsageData.find(
    data => data.year === currentYear && data.month === currentMonth
  );
  const monthlyUsedPoints = thisMonthUsage ? thisMonthUsage.usage : 0;

  // ìµœê·¼ 3ê°œì›” í‰ê·  ì‚¬ìš© í¬ì¸íŠ¸
  const recentThreeMonths = rawPointData.monthlyUsageData.slice(-3);
  const averageUsage = Math.round(
    recentThreeMonths.reduce((sum, data) => sum + data.usage, 0) / recentThreeMonths.length
  );

  // í¬ì¸íŠ¸ ê³„ì‚°
  const pointData = {
    totalPoints: rawPointData.remainingPoints, // í˜„ì¬ ë‚¨ì•„ìˆëŠ” ì „ì²´ í¬ì¸íŠ¸
    availablePoints: rawPointData.remainingPoints - expiringPoints, // ì „ì²´í¬ì¸íŠ¸ - ì†Œë©¸ì˜ˆì •í¬ì¸íŠ¸
    usedPoints: rawPointData.totalUsedPoints, // ëˆ„ì  ì‚¬ìš©í•œ í¬ì¸íŠ¸
    monthlyUsedPoints, // ì´ë²ˆë‹¬ ì‚¬ìš©í•œ í¬ì¸íŠ¸
    totalMembers, // êµ¬ì„±ì› í˜„í™©
    averageUsage, // ìµœê·¼ 3ê°œì›” í‰ê·  ì‚¬ìš© í¬ì¸íŠ¸
    expiringPoints, // ì†Œë©¸ì˜ˆìƒ í¬ì¸íŠ¸
    expirationDate: expirationDate.toLocaleDateString('ko-KR') // ì†Œë©¸ì˜ˆìƒì¼
  };

  // ìµœê·¼ 3ê°œì›” ì‚¬ìš© í˜„í™© ë°ì´í„° (ë™ì  ìƒì„±)
  const getMonthName = (monthIndex) => {
    const months = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];
    return months[monthIndex];
  };

  const chartData = recentThreeMonths.map(data => ({
    month: getMonthName(data.month),
    usage: data.usage,
    count: data.count
  }));

  const maxUsage = Math.max(...chartData.map(d => d.usage));

  // ì´ìš©ì¢…ëª© í˜„í™© (ìµœê·¼ 3ê°œì›” ê¸°ì¤€ìœ¼ë¡œ ë™ì  ê³„ì‚°)
  const categoryData = [
    { name: 'ê°•ë‚¨í—¬ìŠ¤ì¥', icon: 'ğŸ‹ï¸â€â™€ï¸', usage: 426000, percentage: 35 },
    { name: 'ì„œì´ˆí•„ë¼í…ŒìŠ¤', icon: 'ğŸ§˜â€â™€ï¸', usage: 316800, percentage: 26 },
    { name: 'ì—­ì‚¼ìš”ê°€', icon: 'ğŸ§˜â€â™‚ï¸', usage: 231600, percentage: 19 },
    { name: 'ë…¼í˜„í¬ë¡œìŠ¤í•', icon: 'ğŸƒâ€â™€ï¸', usage: 158400, percentage: 13 },
    { name: 'ì‹ ì‚¬PT', icon: 'ğŸ’ª', usage: 85200, percentage: 7 },
    { name: 'ê¸°íƒ€ì‹œì„¤', icon: 'ğŸ¯', usage: 36600, percentage: 3 }
  ];

  // ìµœê·¼ 3ê°œì›” ì´ ì‚¬ìš©ëŸ‰ ê¸°ì¤€ìœ¼ë¡œ ë°±ë¶„ìœ¨ ì¬ê³„ì‚°
  const totalRecentUsage = recentThreeMonths.reduce((sum, data) => sum + data.usage, 0);
  const updatedCategoryData = categoryData.map(category => ({
    ...category,
    // ì‹¤ì œë¡œëŠ” APIì—ì„œ ìµœê·¼ 3ê°œì›” ì¢…ëª©ë³„ ë°ì´í„°ë¥¼ ê°€ì ¸ì™€ì„œ ê³„ì‚°
    percentage: Math.round((category.usage / totalRecentUsage) * 100)
  }));

  return (
    <div className="dashboard">
      <div className="dashboard-header">
        <h2>ëŒ€ì‹œë³´ë“œ</h2>
        <div className="company-name">ë„ì›ì»´í¼ë‹ˆ</div>
      </div>
      
      {/* ì²« ë²ˆì§¸ ì¤„: ì „ì²´ í¬ì¸íŠ¸, ì´ìš©ê°€ëŠ¥ í¬ì¸íŠ¸, ì‚¬ìš©í•œ í¬ì¸íŠ¸ */}
      <div className="dashboard-section">
        <div className="dashboard-cards dashboard-row">
          <div className="dashboard-card clickable" onClick={() => handleCardClick('charge')}>
            <div className="card-label">ì „ì²´ í¬ì¸íŠ¸</div>
            <div className="card-value">{pointData.totalPoints.toLocaleString()}P</div>
          </div>
          <div className="dashboard-card">
            <div className="card-label">ì´ìš©ê°€ëŠ¥ í¬ì¸íŠ¸</div>
            <div className="card-value available">{pointData.availablePoints.toLocaleString()}P</div>
          </div>
          <div className="dashboard-card clickable" onClick={() => handleCardClick('settlement')}>
            <div className="card-label">ì‚¬ìš©í•œ í¬ì¸íŠ¸</div>
            <div className="card-value used">{pointData.usedPoints.toLocaleString()}P</div>
          </div>
        </div>
      </div>

      {/* ë‘ ë²ˆì§¸ ì¤„: ì´ë²ˆë‹¬ ì‚¬ìš©í•œ í¬ì¸íŠ¸, ì†Œë©¸ì˜ˆìƒ í¬ì¸íŠ¸ */}
      <div className="dashboard-section">
        <div className="dashboard-cards dashboard-row">
          <div className="dashboard-card">
            <div className="card-label">ì´ë²ˆë‹¬ ì‚¬ìš©í•œ í¬ì¸íŠ¸</div>
            <div className="card-value monthly">{pointData.monthlyUsedPoints.toLocaleString()}P</div>
          </div>
          <div className="dashboard-card expiring">
            <div className="card-label">ì†Œë©¸ì˜ˆìƒ í¬ì¸íŠ¸</div>
            <div className="card-value expiring">{pointData.expiringPoints.toLocaleString()}P</div>
            <div className="card-sub">ì†Œë©¸ì˜ˆìƒì¼: {pointData.expirationDate}</div>
          </div>
        </div>
      </div>

      {/* ì‚¬ìš© í˜„í™© ê·¸ë˜í”„ */}
      <div className="dashboard-section">
        <div className="usage-chart-container">
          <h3>ì‚¬ìš© í˜„í™© (ìµœê·¼ 3ê°œì›”)</h3>
          <div className="usage-chart">
            {/* êµ¬ë¶„ì„  ê²©ì */}
            <svg className="chart-grid" viewBox="0 0 300 100" preserveAspectRatio="none">
              {/* ìˆ˜í‰ êµ¬ë¶„ì„  (ê°€ë¡œì„ ) */}
              <line x1="0" y1="15" x2="300" y2="15" className="grid-line" />
              <line x1="0" y1="30" x2="300" y2="30" className="grid-line" />
              <line x1="0" y1="45" x2="300" y2="45" className="grid-line" />
              <line x1="0" y1="60" x2="300" y2="60" className="grid-line" />
              <line x1="0" y1="75" x2="300" y2="75" className="grid-line" />
              <line x1="0" y1="90" x2="300" y2="90" className="grid-line" />
              <line x1="0" y1="100" x2="300" y2="100" className="grid-line-bottom" />
              
              {/* ì™¼ìª½ ë ì„¸ë¡œì„  */}
              <line x1="0" y1="0" x2="0" y2="100" className="grid-line-left" />
            </svg>
            
            {/* ë°” ì°¨íŠ¸ */}
            {chartData.map((data, index) => (
              <div key={index} className="chart-bar-container">
                <div className="chart-bar">
                  <div
                    className="chart-bar-fill"
                    style={{ height: `${(data.usage / maxUsage) * 100}%` }}
                  ></div>
                </div>
              </div>
            ))}
          </div>
          {/* ë¼ë²¨ ì˜ì—­ - ë² ì´ìŠ¤ë¼ì¸ ì•„ë˜ ë³„ë„ ì˜ì—­ */}
          <div className="usage-chart-labels">
            {chartData.map((data, index) => (
              <div key={index} className="chart-label-group">
                <div className="chart-label">{data.month}</div>
                <div className="chart-value">{data.usage.toLocaleString()}P</div>
                <div className="chart-count">({data.count}ê±´)</div>
              </div>
            ))}
          </div>
        </div>
      </div>

      {/* ì„¸ ë²ˆì§¸ ì¤„: êµ¬ì„±ì› í˜„í™©, í‰ê·  ì‚¬ìš© í¬ì¸íŠ¸ */}
      <div className="dashboard-section">
        <div className="dashboard-cards dashboard-row">
          <div className="dashboard-card clickable" onClick={() => handleCardClick('members')}>
            <div className="card-label">êµ¬ì„±ì› í˜„í™©</div>
            <div className="card-value members">{pointData.totalMembers}ëª…</div>
          </div>
          <div className="dashboard-card">
            <div className="card-label">í‰ê·  ì‚¬ìš© í¬ì¸íŠ¸</div>
            <div className="card-value average">{pointData.averageUsage.toLocaleString()}P</div>
            <div className="card-sub">ì¸ë‹¹ ì›” í‰ê· </div>
          </div>
        </div>
      </div>

      {/* ì´ìš©ì¢…ëª© í˜„í™© (ìµœê·¼ 3ê°œì›”) */}
      <div className="dashboard-section">
        <div className="usage-categories-container">
          <h3>ì´ìš©ì¢…ëª© í˜„í™© (ìµœê·¼ 3ê°œì›”)</h3>
          <div className="categories-grid">
            {updatedCategoryData.map((category, index) => (
              <div key={index} className="category-item">
                <div className="category-icon">{category.icon}</div>
                <div className="category-name">{category.name}</div>
                <div className="category-usage">{category.usage.toLocaleString()}P</div>
                <div className="category-percentage">{category.percentage}%</div>
              </div>
            ))}
          </div>
        </div>
      </div>
    </div>
  );
}

function Settlement() {
  const navigate = useNavigate();
  const [settlements, setSettlements] = useState([
    { id: 1, quarter: "2ë¶„ê¸°", period: "2024-04-01 ~ 2024-06-30", amount: 1000000, status: "ì™„ë£Œ", startDate: "2024-04-01" },
    { id: 2, quarter: "1ë¶„ê¸°", period: "2024-01-01 ~ 2024-03-31", amount: 850000, status: "ê²°ì œì „", startDate: "2024-01-01" },
    { id: 3, quarter: "3ë¶„ê¸°", period: "2024-07-01 ~ 2024-09-30", amount: 1200000, status: "ì™„ë£Œ", startDate: "2024-07-01" },
    { id: 4, quarter: "4ë¶„ê¸°", period: "2024-10-01 ~ 2024-12-31", amount: 950000, status: "ê²°ì œì „", startDate: "2024-10-01" },
  ].sort((a, b) => new Date(b.startDate) - new Date(a.startDate))); // ìµœì‹ ìˆœ ì •ë ¬

  const handleRowClick = (id) => {
    navigate(`/settlement/${id}`);
  };

  return (
    <div className="settlement-page">
      <h2>ì •ì‚°</h2>
      <div className="settlement-filter">
        <label>ë¶„ê¸°ë³„:
          <select>
            <option>ì „ì²´</option>
            <option>1ë¶„ê¸°</option>
            <option>2ë¶„ê¸°</option>
            <option>3ë¶„ê¸°</option>
            <option>4ë¶„ê¸°</option>
          </select>
        </label>
        <label>ê²°ì œìƒíƒœ:
          <select>
            <option>ì „ì²´</option>
            <option>ì™„ë£Œ</option>
            <option>ê²°ì œì „</option>
          </select>
        </label>
        <label>ì‹œì‘ì¼:
          <input type="date" />
        </label>
        <label>ì¢…ë£Œì¼:
          <input type="date" />
        </label>
        <button>ì¡°íšŒ</button>
      </div>
      <table className="settlement-table">
        <thead>
          <tr>
            <th>ì •ì‚°ID</th>
            <th>ë¶„ê¸°</th>
            <th>ê¸°ê°„</th>
            <th>ê²°ì œ ì˜ˆì •ê¸ˆì•¡</th>
            <th>ê²°ì œìƒíƒœ</th>
          </tr>
        </thead>
        <tbody>
          {settlements.map(settlement => (
            <tr key={settlement.id} onClick={() => handleRowClick(settlement.id)} style={{cursor:'pointer'}}>
              <td>{settlement.id}</td>
              <td>{settlement.quarter}</td>
              <td>{settlement.period}</td>
              <td>{settlement.amount.toLocaleString()}ì›</td>
              <td>
                <span className={`status ${settlement.status === 'ì™„ë£Œ' ? 'status-completed' : 'status-pending'}`}>
                  {settlement.status}
                </span>
              </td>
            </tr>
          ))}
        </tbody>
      </table>
    </div>
  );
}

function SettlementDetail() {
  const { id } = useParams();
  const navigate = useNavigate();
  
  // ì •ì‚° ë°ì´í„° (ì‹¤ì œë¡œëŠ” APIì—ì„œ ê°€ì ¸ì˜´)
  const settlementData = {
    1: {
      id: 1,
      quarter: "2ë¶„ê¸°",
      period: "2024-04-01 ~ 2024-06-30",
      totalAmount: 1000000,
      status: "ì™„ë£Œ",
      usageData: [
        { id: 1, memberName: "í™ê¸¸ë™", department: "ì˜ì—…", facility: "ê°•ë‚¨í—¬ìŠ¤ì¥", usageDate: "2024-04-15", points: 5000, amount: 50000 },
        { id: 2, memberName: "ê¹€ì² ìˆ˜", department: "ê°œë°œ", facility: "ì„œì´ˆí•„ë¼í…ŒìŠ¤", usageDate: "2024-04-20", points: 3000, amount: 30000 },
        { id: 3, memberName: "ì´ì˜í¬", department: "ë””ìì¸", facility: "ì—­ì‚¼ìš”ê°€", usageDate: "2024-05-10", points: 2000, amount: 20000 },
        { id: 4, memberName: "í™ê¸¸ë™", department: "ì˜ì—…", facility: "ë…¼í˜„í¬ë¡œìŠ¤í•", usageDate: "2024-05-25", points: 4000, amount: 40000 },
        { id: 5, memberName: "ê¹€ì² ìˆ˜", department: "ê°œë°œ", facility: "ê°•ë‚¨í—¬ìŠ¤ì¥", usageDate: "2024-06-05", points: 6000, amount: 60000 }
      ]
    },
    2: {
      id: 2,
      quarter: "1ë¶„ê¸°",
      period: "2024-01-01 ~ 2024-03-31",
      totalAmount: 850000,
      status: "ê²°ì œì „",
      usageData: [
        { id: 6, memberName: "ë°•ë¯¼ìˆ˜", department: "ë§ˆì¼€íŒ…", facility: "ë…¼í˜„í¬ë¡œìŠ¤í•", usageDate: "2024-01-10", points: 7000, amount: 70000 },
        { id: 7, memberName: "ì •ìˆ˜ì§„", department: "ì¸ì‚¬", facility: "ì„œì´ˆí•„ë¼í…ŒìŠ¤", usageDate: "2024-02-14", points: 2500, amount: 25000 }
      ]
    }
  };

  const settlement = settlementData[id];
  
  if (!settlement) {
    return (
      <div className="settlement-detail-page">
        <h2>ì •ì‚° ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.</h2>
        <button onClick={() => navigate("/settlement")} className="back-btn">
          ëŒì•„ê°€ê¸°
        </button>
      </div>
    );
  }

  // êµ¬ì„±ì›ë³„ í†µê³„ ê³„ì‚°
  const memberStats = settlement.usageData.reduce((acc, usage) => {
    if (!acc[usage.memberName]) {
      acc[usage.memberName] = {
        memberName: usage.memberName,
        department: usage.department,
        totalPoints: 0,
        totalAmount: 0,
        usageCount: 0
      };
    }
    acc[usage.memberName].totalPoints += usage.points;
    acc[usage.memberName].totalAmount += usage.amount;
    acc[usage.memberName].usageCount += 1;
    return acc;
  }, {});

  const memberStatsList = Object.values(memberStats);

  return (
    <div className="settlement-detail-page">
      <div className="settlement-detail-header">
        <div className="header-left">
          <button onClick={() => navigate("/settlement")} className="back-btn">
            â† ëŒì•„ê°€ê¸°
          </button>
        </div>
        <div className="header-center">
          <h2>ì •ì‚° ìƒì„¸ - {settlement.quarter}</h2>
          <p className="period">{settlement.period}</p>
        </div>
        <div className="header-right">
          <span className={`status ${settlement.status === 'ì™„ë£Œ' ? 'status-completed' : 'status-pending'}`}>
            {settlement.status}
          </span>
        </div>
      </div>

      <div className="settlement-summary">
        <div className="summary-cards">
          <div className="summary-card">
            <h3>ì´ ê²°ì œ ê¸ˆì•¡</h3>
            <p className="amount">{settlement.totalAmount.toLocaleString()}ì›</p>
          </div>
          <div className="summary-card">
            <h3>ì´ìš© êµ¬ì„±ì›</h3>
            <p className="count">{memberStatsList.length}ëª…</p>
          </div>
          <div className="summary-card">
            <h3>ì´ ì´ìš© ê±´ìˆ˜</h3>
            <p className="count">{settlement.usageData.length}ê±´</p>
          </div>
          <div className="summary-card">
            <h3>ì´ ì‚¬ìš© í¬ì¸íŠ¸</h3>
            <p className="points">{settlement.usageData.reduce((sum, usage) => sum + usage.points, 0).toLocaleString()}P</p>
          </div>
        </div>
      </div>

      <div className="detail-tabs">
        <div className="tab-content">
          <h3>êµ¬ì„±ì›ë³„ ì´ìš© í˜„í™©</h3>
          <table className="member-stats-table">
            <thead>
              <tr>
                <th>êµ¬ì„±ì›ëª…</th>
                <th>ë¶€ì„œ</th>
                <th>ì´ìš© ê±´ìˆ˜</th>
                <th>ì‚¬ìš© í¬ì¸íŠ¸</th>
                <th>ì‚¬ìš© ê¸ˆì•¡</th>
              </tr>
            </thead>
            <tbody>
              {memberStatsList.map((member, index) => (
                <tr key={index}>
                  <td>{member.memberName}</td>
                  <td>{member.department}</td>
                  <td>{member.usageCount}ê±´</td>
                  <td>{member.totalPoints.toLocaleString()}P</td>
                  <td>{member.totalAmount.toLocaleString()}ì›</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>

        <div className="tab-content">
          <h3>ìƒì„¸ ì´ìš© ë‚´ì—­</h3>
          <table className="usage-detail-table">
            <thead>
              <tr>
                <th>ì´ìš©ì¼</th>
                <th>êµ¬ì„±ì›ëª…</th>
                <th>ë¶€ì„œ</th>
                <th>ì´ìš© ì‹œì„¤</th>
                <th>ì‚¬ìš© í¬ì¸íŠ¸</th>
                <th>ì‚¬ìš© ê¸ˆì•¡</th>
              </tr>
            </thead>
            <tbody>
              {settlement.usageData.map((usage) => (
                <tr key={usage.id}>
                  <td>{usage.usageDate}</td>
                  <td>{usage.memberName}</td>
                  <td>{usage.department}</td>
                  <td>{usage.facility}</td>
                  <td>{usage.points.toLocaleString()}P</td>
                  <td>{usage.amount.toLocaleString()}ì›</td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
}

function UsageTable() {
  const [search, setSearch] = useState(""); // ì´ë¦„/ë¶€ì„œ ê²€ìƒ‰
  const [deptFilter, setDeptFilter] = useState("ì „ì²´"); // ë¶€ì„œ í•„í„°
  const [quarterFilter, setQuarterFilter] = useState("ì „ì²´"); // ë¶„ê¸° í•„í„°
  const [startDate, setStartDate] = useState(""); // ì‹œì‘ì¼
  const [endDate, setEndDate] = useState(""); // ì¢…ë£Œì¼
  const [viewMode, setViewMode] = useState("list"); // "list" ë˜ëŠ” "department"
  const [collapsedDepts, setCollapsedDepts] = useState({}); // ì ‘íŒ ë¶€ì„œë“¤
  const [usageData, setUsageData] = useState([
    { id: 1, memberName: "í™ê¸¸ë™", department: "ì˜ì—…", facility: "ê°•ë‚¨í—¬ìŠ¤ì¥", usageDate: "2024-10-15", points: 5000, amount: 50000 },
    { id: 2, memberName: "ê¹€ì² ìˆ˜", department: "ê°œë°œ", facility: "ì„œì´ˆí•„ë¼í…ŒìŠ¤", usageDate: "2024-10-20", points: 3000, amount: 30000 },
    { id: 3, memberName: "ì´ì˜í¬", department: "ë””ìì¸", facility: "ì—­ì‚¼ìš”ê°€", usageDate: "2024-09-25", points: 2000, amount: 20000 },
    { id: 4, memberName: "ë°•ë¯¼ìˆ˜", department: "ë§ˆì¼€íŒ…", facility: "ë…¼í˜„í¬ë¡œìŠ¤í•", usageDate: "2024-09-30", points: 4000, amount: 40000 },
    { id: 5, memberName: "í™ê¸¸ë™", department: "ì˜ì—…", facility: "ê°•ë‚¨í—¬ìŠ¤ì¥", usageDate: "2024-08-10", points: 6000, amount: 60000 },
    { id: 6, memberName: "ê¹€ì² ìˆ˜", department: "ê°œë°œ", facility: "ì„œì´ˆí•„ë¼í…ŒìŠ¤", usageDate: "2024-07-15", points: 3500, amount: 35000 },
    { id: 7, memberName: "ì •ìˆ˜ì§„", department: "ì¸ì‚¬", facility: "ì—­ì‚¼ìš”ê°€", usageDate: "2024-10-05", points: 2500, amount: 25000 },
    { id: 8, memberName: "ì´ì˜í¬", department: "ë””ìì¸", facility: "ë…¼í˜„í¬ë¡œìŠ¤í•", usageDate: "2024-09-12", points: 4500, amount: 45000 }
  ]);

  const departments = ["ì „ì²´", "ì˜ì—…", "ê°œë°œ", "ë””ìì¸", "ë§ˆì¼€íŒ…", "ì¸ì‚¬"];
  const quarters = ["ì „ì²´", "1ë¶„ê¸°", "2ë¶„ê¸°", "3ë¶„ê¸°", "4ë¶„ê¸°"];

  // ë¶„ê¸° ê³„ì‚° í•¨ìˆ˜
  const getQuarter = (date) => {
    const month = new Date(date).getMonth() + 1;
    if (month <= 3) return "1ë¶„ê¸°";
    if (month <= 6) return "2ë¶„ê¸°";
    if (month <= 9) return "3ë¶„ê¸°";
    return "4ë¶„ê¸°";
  };

  // ë°ì´í„° í•„í„°ë§
  const filteredData = usageData.filter(usage => {
    // ì´ë¦„/ë¶€ì„œ ê²€ìƒ‰
    const searchMatch = search === "" || 
      usage.memberName.includes(search) || 
      usage.department.includes(search);
    
    // ë¶€ì„œ í•„í„°
    const deptMatch = deptFilter === "ì „ì²´" || usage.department === deptFilter;
    
    // ë¶„ê¸° í•„í„°
    const quarterMatch = quarterFilter === "ì „ì²´" || getQuarter(usage.usageDate) === quarterFilter;
    
    // ê¸°ê°„ í•„í„°
    let dateMatch = true;
    if (startDate && endDate) {
      const usageDate = new Date(usage.usageDate);
      const start = new Date(startDate);
      const end = new Date(endDate);
      dateMatch = usageDate >= start && usageDate <= end;
    }
    
    return searchMatch && deptMatch && quarterMatch && dateMatch;
  });

  // í•„í„° ì´ˆê¸°í™”
  const handleReset = () => {
    setSearch("");
    setDeptFilter("ì „ì²´");
    setQuarterFilter("ì „ì²´");
    setStartDate("");
    setEndDate("");
  };

  // ë¶€ì„œë³„ ê·¸ë£¹í™”
  const groupedByDepartment = filteredData.reduce((groups, usage) => {
    const department = usage.department;
    if (!groups[department]) {
      groups[department] = [];
    }
    groups[department].push(usage);
    return groups;
  }, {});

  // ë¶€ì„œ ì ‘ê¸°/í¼ì¹˜ê¸°
  const toggleDepartment = (department) => {
    setCollapsedDepts(prev => ({
      ...prev,
      [department]: !prev[department]
    }));
  };

  return (
    <div className="usage-table-page">
      <div className="usage-header">
        <h2>ì´ìš©í˜„í™©</h2>
        <div className="view-mode-buttons">
          <button
            className={`view-mode-btn ${viewMode === "list" ? "active" : ""}`}
            onClick={() => setViewMode("list")}
          >
            ğŸ“‹ ì´ë¦„ìœ¼ë¡œ ë³´ê¸°
          </button>
          <button
            className={`view-mode-btn ${viewMode === "department" ? "active" : ""}`}
            onClick={() => setViewMode("department")}
          >
            ğŸ¢ ë¶€ì„œë³„ ë³´ê¸°
          </button>
        </div>
      </div>
      
      {/* ê²€ìƒ‰ ë° í•„í„° ì„¹ì…˜ */}
      <div className="usage-filters">
        {/* ì²« ë²ˆì§¸ ì¤„: ê²€ìƒ‰ */}
        <div className="filter-row">
          <div className="search-group">
            <label>ê²€ìƒ‰ (ì´ë¦„/ë¶€ì„œ):</label>
            <input
              type="text"
              value={search}
              onChange={(e) => setSearch(e.target.value)}
              placeholder="êµ¬ì„±ì›ëª… ë˜ëŠ” ë¶€ì„œëª… ì…ë ¥"
              className="search-input"
            />
          </div>
        </div>
        
        {/* ë‘ ë²ˆì§¸ ì¤„: ë¶€ì„œ, ë¶„ê¸° í•„í„°, ì´ˆê¸°í™” ë²„íŠ¼ */}
        <div className="filter-row">
          <div className="filter-group">
            <label>ë¶€ì„œ:</label>
            <select value={deptFilter} onChange={(e) => setDeptFilter(e.target.value)} className="filter-select">
              {departments.map(dept => (
                <option key={dept} value={dept}>{dept}</option>
              ))}
            </select>
          </div>
          
          <div className="filter-group">
            <label>ë¶„ê¸°:</label>
            <select value={quarterFilter} onChange={(e) => setQuarterFilter(e.target.value)} className="filter-select">
              {quarters.map(quarter => (
                <option key={quarter} value={quarter}>{quarter}</option>
              ))}
            </select>
          </div>
          
          <button onClick={handleReset} className="reset-btn">
            í•„í„° ì´ˆê¸°í™”
          </button>
        </div>
        
        {/* ì„¸ ë²ˆì§¸ ì¤„: ê¸°ê°„ ì§€ì • */}
        <div className="filter-row">
          <div className="date-group">
            <label>ê¸°ê°„ ì§€ì •:</label>
            <div className="date-inputs">
              <input
                type="date"
                value={startDate}
                onChange={(e) => setStartDate(e.target.value)}
                className="date-input"
              />
              <span className="date-separator">~</span>
              <input
                type="date"
                value={endDate}
                onChange={(e) => setEndDate(e.target.value)}
                className="date-input"
              />
            </div>
          </div>
        </div>
      </div>

      {/* ê²°ê³¼ ìš”ì•½ */}
      <div className="usage-summary">
        <span>ì´ {filteredData.length}ê±´ì˜ ì´ìš© ë‚´ì—­</span>
        <span>ì´ ì‚¬ìš© í¬ì¸íŠ¸: {filteredData.reduce((sum, usage) => sum + usage.points, 0).toLocaleString()}P</span>
        <span>ì´ ì‚¬ìš© ê¸ˆì•¡: {filteredData.reduce((sum, usage) => sum + usage.amount, 0).toLocaleString()}ì›</span>
      </div>
      
      {/* ì´ë¦„ìœ¼ë¡œ ë³´ê¸° - ê¸°ì¡´ í…Œì´ë¸” */}
      {viewMode === "list" && (
        <table className="usage-table">
          <thead>
            <tr>
              <th>ì´ìš©ì¼</th>
              <th>êµ¬ì„±ì›ëª…</th>
              <th>ë¶€ì„œ</th>
              <th>ì‹œì„¤ëª…</th>
              <th>ì‚¬ìš© í¬ì¸íŠ¸</th>
              <th>ì‚¬ìš©ê¸ˆì•¡</th>
            </tr>
          </thead>
          <tbody>
            {filteredData.length > 0 ? (
              filteredData.map(usage => (
                <tr key={usage.id}>
                  <td>{usage.usageDate}</td>
                  <td>{usage.memberName}</td>
                  <td>{usage.department}</td>
                  <td>{usage.facility}</td>
                  <td>{usage.points.toLocaleString()}P</td>
                  <td>{usage.amount.toLocaleString()}ì›</td>
                </tr>
              ))
            ) : (
              <tr>
                <td colSpan="6" className="no-data">ê²€ìƒ‰ ì¡°ê±´ì— ë§ëŠ” ì´ìš© ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</td>
              </tr>
            )}
          </tbody>
        </table>
      )}

      {/* ë¶€ì„œë³„ ë³´ê¸° */}
      {viewMode === "department" && (
        <div className="department-view">
          {Object.entries(groupedByDepartment).map(([department, usages]) => {
            const isCollapsed = collapsedDepts[department];
            const deptTotalPoints = usages.reduce((sum, usage) => sum + usage.points, 0);
            const deptTotalAmount = usages.reduce((sum, usage) => sum + usage.amount, 0);
            
            return (
              <div key={department} className="department-section">
                <div 
                  className="department-header-compact" 
                  onClick={() => toggleDepartment(department)}
                >
                  <div className="department-toggle">
                    <span className={`toggle-icon ${isCollapsed ? 'collapsed' : ''}`}>â–¼</span>
                    <span className="department-title">{department}</span>
                    <span className="department-count">({usages.length}ê±´)</span>
                  </div>
                  <div className="department-total-points">
                    {deptTotalPoints.toLocaleString()}P ({deptTotalAmount.toLocaleString()}ì›)
                  </div>
                </div>
                
                {!isCollapsed && (
                  <div className="department-usage-list">
                    {usages.map(usage => (
                      <div key={usage.id} className="usage-row-card">
                        <div className="usage-date">{usage.usageDate}</div>
                        <div className="usage-info">
                          <div className="usage-member-primary">{usage.memberName}</div>
                          <div className="usage-details-row">
                            <span className="usage-facility-info">ì‹œì„¤: {usage.facility}</span>
                            <span className="usage-point-info">í¬ì¸íŠ¸: {usage.points.toLocaleString()}P</span>
                            <span className="usage-amount-info">ê¸ˆì•¡: {usage.amount.toLocaleString()}ì›</span>
                          </div>
                        </div>
                      </div>
                    ))}
                  </div>
                )}
              </div>
            );
          })}
        </div>
      )}
    </div>
  );
}

function GiftPage({ members, setMembers }) {
  const [availablePoints, setAvailablePoints] = useState(500000); // ì„ ë¬¼ ê°€ëŠ¥í•œ í¬ì¸íŠ¸
  const [search, setSearch] = useState("");
  const [dept, setDept] = useState("ì „ì²´");
  const [selectedGifts, setSelectedGifts] = useState({}); // ê° êµ¬ì„±ì›ë³„ ì„ ë¬¼í•  í¬ì¸íŠ¸

  const departments = ["ì „ì²´", "ì˜ì—…", "ê°œë°œ", "ë””ìì¸"];

  // í•„í„°ë§
  const filtered = members.filter(
    m =>
      (dept === "ì „ì²´" || m.department === dept) &&
      m.name.includes(search)
  );

  // ì„ ë¬¼ í¬ì¸íŠ¸ ë³€ê²½
  const handleGiftChange = (memberId, points) => {
    setSelectedGifts({
      ...selectedGifts,
      [memberId]: Number(points) || 0
    });
  };

  // ì„ ë¬¼í•˜ê¸° ì‹¤í–‰
  const handleSendGift = (memberId) => {
    const giftPoints = selectedGifts[memberId] || 0;
    if (giftPoints <= 0) {
      alert("ì„ ë¬¼í•  í¬ì¸íŠ¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }
    if (giftPoints > availablePoints) {
      alert("ì„ ë¬¼ ê°€ëŠ¥í•œ í¬ì¸íŠ¸ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤.");
      return;
    }

    // êµ¬ì„±ì›ì—ê²Œ í¬ì¸íŠ¸ ì„ ë¬¼
    setMembers(members =>
      members.map(m =>
        m.id === memberId ? { ...m, point: m.point + giftPoints } : m
      )
    );

    // ì„ ë¬¼ ê°€ëŠ¥í•œ í¬ì¸íŠ¸ ì°¨ê°
    setAvailablePoints(prev => prev - giftPoints);

    // ì„ ë¬¼ ë‚´ì—­ ì´ˆê¸°í™”
    setSelectedGifts({
      ...selectedGifts,
      [memberId]: 0
    });

    const member = members.find(m => m.id === memberId);
    alert(`${member.name}ë‹˜ì—ê²Œ ${giftPoints.toLocaleString()}í¬ì¸íŠ¸ë¥¼ ì„ ë¬¼í–ˆìŠµë‹ˆë‹¤! ğŸ`);
  };

  // ì´ ì„ ë¬¼ ì˜ˆì • í¬ì¸íŠ¸ ê³„ì‚°
  const totalGiftPoints = Object.values(selectedGifts).reduce((sum, points) => sum + (points || 0), 0);

  return (
    <div className="gift-page">
      <h2>ì„ ë¬¼í•˜ê¸° ğŸ</h2>
      
      <div className="gift-points-compact">
        <div className="points-row">
          <span className="label">ì„ ë¬¼ ê°€ëŠ¥í•œ í¬ì¸íŠ¸:</span>
          <span className="value">{availablePoints.toLocaleString()}P</span>
        </div>
        {totalGiftPoints > 0 && (
          <>
            <div className="points-row preview">
              <span className="label">ì„ ë¬¼ ì˜ˆì •:</span>
              <span className="value preview-highlight">{totalGiftPoints.toLocaleString()}P</span>
            </div>
            <div className="points-row after">
              <span className="label">ì„ ë¬¼ í›„ ì”ì—¬:</span>
              <span className="value after-highlight">{(availablePoints - totalGiftPoints).toLocaleString()}P</span>
            </div>
          </>
        )}
      </div>

      <div className="member-search-section">
        <h3>êµ¬ì„±ì› ê²€ìƒ‰</h3>
        <div className="search-filters">
          <input
            type="text"
            placeholder="êµ¬ì„±ì› ì´ë¦„ ê²€ìƒ‰"
            value={search}
            onChange={e => setSearch(e.target.value)}
            className="search-input"
          />
          <select value={dept} onChange={e => setDept(e.target.value)} className="dept-select">
            {departments.map(d => (
              <option key={d} value={d}>{d}</option>
            ))}
          </select>
        </div>
      </div>

      <div className="gift-member-list">
        <h3>êµ¬ì„±ì› ëª©ë¡</h3>
        <table className="gift-table">
          <thead>
            <tr>
              <th>ì´ë¦„</th>
              <th>ë¶€ì„œ</th>
              <th>ì‚¬ì›ë²ˆí˜¸</th>
              <th>í˜„ì¬ í¬ì¸íŠ¸</th>
              <th>ì…ì‚¬ì¼</th>
              <th>ì„ ë¬¼í•  í¬ì¸íŠ¸</th>
              <th>ì„ ë¬¼í•˜ê¸°</th>
            </tr>
          </thead>
          <tbody>
            {filtered.map(m => (
              <tr key={m.id}>
                <td>{m.name}</td>
                <td>{m.department}</td>
                <td>{m.empNo}</td>
                <td>{m.point.toLocaleString()}P</td>
                <td>{m.joinDate}</td>
                <td>
                  <input
                    type="number"
                    value={selectedGifts[m.id] || ""}
                    onChange={(e) => handleGiftChange(m.id, e.target.value)}
                    placeholder="í¬ì¸íŠ¸"
                    min="0"
                    max={availablePoints}
                    className="gift-input"
                  />
                </td>
                <td>
                  <button
                    className="gift-btn"
                    onClick={() => handleSendGift(m.id)}
                    disabled={!selectedGifts[m.id] || selectedGifts[m.id] <= 0}
                  >
                    ğŸ ì„ ë¬¼
                  </button>
                </td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>
    </div>
  );
}

function PointCharge() {
  const [totalAmount, setTotalAmount] = useState(0); // ì´ ì¶©ì „ ê¸ˆì•¡ (ëˆ„ì )
  const [customAmount, setCustomAmount] = useState("");
  const [paymentMethod, setPaymentMethod] = useState("card");
  const [currentPoints, setCurrentPoints] = useState(125000); // í˜„ì¬ ì´ìš©ê°€ëŠ¥í•œ í¬ì¸íŠ¸
  const [showPaymentModal, setShowPaymentModal] = useState(false); // ê²°ì œ ë°©ë²• íŒì—… ìƒíƒœ
  const [chargeHistory, setChargeHistory] = useState([
    { id: 1, date: "2024-01-15", amount: 100000, method: "ì¹´ë“œê²°ì œ", status: "ì™„ë£Œ" },
    { id: 2, date: "2024-01-10", amount: 50000, method: "ê³„ì¢Œì´ì²´", status: "ì™„ë£Œ" },
  ]);

  const amounts = [10000, 30000, 50000, 100000, 200000, 500000];

  const handleAmountSelect = (amount) => {
    setTotalAmount(prev => prev + amount); // ê¸°ì¡´ ê¸ˆì•¡ì— ëˆ„ì 
    setCustomAmount("");
  };

  const handleCustomAmountChange = (value) => {
    setCustomAmount(value);
    setTotalAmount(0); // ì§ì ‘ ì…ë ¥ ì‹œ ëˆ„ì  ê¸ˆì•¡ ì´ˆê¸°í™”
  };

  const handleAddCustomAmount = () => {
    const amount = Number(customAmount);
    if (amount > 0) {
      setTotalAmount(prev => prev + amount);
      setCustomAmount("");
    }
  };

  const handleReset = () => {
    setTotalAmount(0);
    setCustomAmount("");
  };

  const handleChargeClick = () => {
    const amount = totalAmount || Number(customAmount);
    if (!amount || amount < 1000) {
      alert("ìµœì†Œ 1,000ì› ì´ìƒ ì¶©ì „í•´ì£¼ì„¸ìš”.");
      return;
    }
    setShowPaymentModal(true);
  };

  const handlePaymentConfirm = (selectedMethod) => {
    const amount = totalAmount || Number(customAmount);
    
    // ê²°ì œ ì²˜ë¦¬ ë¡œì§ (ì‹¤ì œë¡œëŠ” ê²°ì œ API ì—°ë™)
    const newCharge = {
      id: chargeHistory.length + 1,
      date: new Date().toISOString().split('T')[0],
      amount: amount,
      method: selectedMethod === "card" ? "ì¹´ë“œê²°ì œ" : "ê³„ì¢Œì´ì²´",
      status: "ì™„ë£Œ"
    };
    
    setChargeHistory([newCharge, ...chargeHistory]);
    setCurrentPoints(prev => prev + amount); // ì¶©ì „ í›„ í˜„ì¬ í¬ì¸íŠ¸ ì—…ë°ì´íŠ¸
    setTotalAmount(0);
    setCustomAmount("");
    setShowPaymentModal(false);
    alert(`${amount.toLocaleString()}ì›ì´ ì¶©ì „ë˜ì—ˆìŠµë‹ˆë‹¤.`);
  };

  return (
    <div className="charge-page">
      <h2>í¬ì¸íŠ¸ ì¶©ì „</h2>
      
      <div className="current-points-compact">
        <div className="points-row">
          <span className="label">ì´ìš©ê°€ëŠ¥ í¬ì¸íŠ¸:</span>
          <span className="value">{currentPoints.toLocaleString()}P</span>
        </div>
        {totalAmount > 0 && (
          <div className="points-row charge-preview">
            <span className="label">ì¶©ì „ í›„:</span>
            <span className="value preview">{(currentPoints + totalAmount).toLocaleString()}P</span>
          </div>
        )}
      </div>
      
      <div className="charge-section">
        <h3>ì¶©ì „ ê¸ˆì•¡ ì„ íƒ</h3>
        <div className="charge-total-row">
          <div className="total-info">
            <span className="total-label">ì„ íƒ ê¸ˆì•¡:</span>
            <span className="total-value">{totalAmount.toLocaleString()}ì›</span>
          </div>
          {totalAmount > 0 && (
            <button className="reset-small-btn" onClick={handleReset}>
              ì´ˆê¸°í™”
            </button>
          )}
        </div>
        
        <div className="amount-buttons">
          {amounts.map(amount => (
            <button
              key={amount}
              className="amount-btn"
              onClick={() => handleAmountSelect(amount)}
            >
              +{amount.toLocaleString()}ì›
            </button>
          ))}
        </div>
        
        <div className="custom-amount">
          <label>ì§ì ‘ ì…ë ¥:</label>
          <input
            type="number"
            value={customAmount}
            onChange={(e) => handleCustomAmountChange(e.target.value)}
            placeholder="ì¶”ê°€í•  ê¸ˆì•¡ì„ ì…ë ¥í•˜ì„¸ìš”"
            min="1000"
          />
          <span>ì›</span>
          {customAmount && (
            <button className="add-custom-btn" onClick={handleAddCustomAmount}>
              ì¶”ê°€
            </button>
          )}
        </div>
      </div>

      <div className="payment-section">
        <h3>ê²°ì œ ë°©ë²•</h3>
        <div className="payment-methods">
          <label>
            <input
              type="radio"
              value="card"
              checked={paymentMethod === "card"}
              onChange={(e) => setPaymentMethod(e.target.value)}
            />
            ì‹ ìš©ì¹´ë“œ/ì²´í¬ì¹´ë“œ
          </label>
          <label>
            <input
              type="radio"
              value="transfer"
              checked={paymentMethod === "transfer"}
              onChange={(e) => setPaymentMethod(e.target.value)}
            />
            ê³„ì¢Œì´ì²´
          </label>
        </div>
      </div>

      <div className="charge-summary">
        <h3>ì¶©ì „ ì •ë³´</h3>
        <div className="summary-item">
          <span>ì¶©ì „ ê¸ˆì•¡:</span>
          <span className="amount">{(totalAmount || Number(customAmount) || 0).toLocaleString()}ì›</span>
        </div>
        <div className="summary-item">
          <span>ê²°ì œ ë°©ë²•:</span>
          <span>{paymentMethod === "card" ? "ì‹ ìš©ì¹´ë“œ/ì²´í¬ì¹´ë“œ" : "ê³„ì¢Œì´ì²´"}</span>
        </div>
      </div>

      <button className="charge-btn" onClick={handleChargeClick}>
        {(totalAmount || Number(customAmount) || 0).toLocaleString()}ì› ì¶©ì „í•˜ê¸°
      </button>

      <div className="charge-history">
        <h3>ì¶©ì „ ë‚´ì—­</h3>
        <table className="history-table">
          <thead>
            <tr>
              <th>ë‚ ì§œ</th>
              <th>ì¶©ì „ ê¸ˆì•¡</th>
              <th>ê²°ì œ ë°©ë²•</th>
              <th>ìƒíƒœ</th>
            </tr>
          </thead>
          <tbody>
            {chargeHistory.map(item => (
              <tr key={item.id}>
                <td>{item.date}</td>
                <td>{item.amount.toLocaleString()}ì›</td>
                <td>{item.method}</td>
                <td><span className="status-complete">{item.status}</span></td>
              </tr>
            ))}
          </tbody>
        </table>
      </div>

      {/* ê²°ì œ ë°©ë²• ì„ íƒ íŒì—… */}
      {showPaymentModal && (
        <div className="modal-overlay" onClick={() => setShowPaymentModal(false)}>
          <div className="payment-modal" onClick={(e) => e.stopPropagation()}>
            <div className="payment-modal-header">
              <h3>ê²°ì œ ë°©ë²• ì„ íƒ</h3>
              <button className="close-btn" onClick={() => setShowPaymentModal(false)}>
                âœ•
              </button>
            </div>
            <div className="payment-modal-content">
              <div className="charge-amount-display">
                ì¶©ì „ ê¸ˆì•¡: <span className="amount-highlight">{(totalAmount || Number(customAmount) || 0).toLocaleString()}ì›</span>
              </div>
              <div className="payment-options">
                <button 
                  className="payment-option-btn card"
                  onClick={() => handlePaymentConfirm("card")}
                >
                  <div className="payment-icon">ğŸ’³</div>
                  <div className="payment-text">
                    <div className="payment-title">ì‹ ìš©ì¹´ë“œ/ì²´í¬ì¹´ë“œ</div>
                    <div className="payment-desc">ì¹´ë“œ ê²°ì œë¡œ ì¦‰ì‹œ ì¶©ì „</div>
                  </div>
                </button>
                <button 
                  className="payment-option-btn transfer"
                  onClick={() => handlePaymentConfirm("transfer")}
                >
                  <div className="payment-icon">ğŸ¦</div>
                  <div className="payment-text">
                    <div className="payment-title">ê³„ì¢Œì´ì²´</div>
                    <div className="payment-desc">ê³„ì¢Œ ì´ì²´ë¡œ ì•ˆì „ ê²°ì œ</div>
                  </div>
                </button>
              </div>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

function AdminLayout({ members, setMembers, handleAddMember, handleUpdateMember }) {
  const location = useLocation();
  const [departments, setDepartments] = useState([
    { id: 1, companyName: "í…Œí¬ë…¸ë¸”", departmentName: "ê°œë°œë¶€", teamName: "í”„ë¡ íŠ¸ì—”ë“œíŒ€" },
    { id: 2, companyName: "í…Œí¬ë…¸ë¸”", departmentName: "ê°œë°œë¶€", teamName: "ë°±ì—”ë“œíŒ€" },
    { id: 3, companyName: "í…Œí¬ë…¸ë¸”", departmentName: "ì˜ì—…ë¶€", teamName: "ê¸°ì—…ì˜ì—…íŒ€" },
    { id: 4, companyName: "í…Œí¬ë…¸ë¸”", departmentName: "ë§ˆì¼€íŒ…ë¶€", teamName: "ë””ì§€í„¸ë§ˆì¼€íŒ…íŒ€" },
    { id: 5, companyName: "í…Œí¬ë…¸ë¸”", departmentName: "ì¸ì‚¬ë¶€", teamName: "ì±„ìš©íŒ€" }
  ]);

  const handleAddDepartment = (newDept) => {
    const newId = Math.max(...departments.map(d => d.id)) + 1;
    setDepartments(prev => [...prev, { ...newDept, id: newId }]);
  };

  return (
    <div className="admin-layout">
      <aside className="sidebar">
        <ul>
          <li className={location.pathname === "/" ? "active" : ""}><Link to="/">í™ˆ</Link></li>
          <li className={location.pathname.startsWith("/members") ? "active" : ""}><Link to="/members">êµ¬ì„±ì›</Link></li>
          <li className={location.pathname.startsWith("/settlement") ? "active" : ""}><Link to="/settlement">ì •ì‚°</Link></li>
          <li className={location.pathname.startsWith("/charge") ? "active" : ""}><Link to="/charge">í¬ì¸íŠ¸ ì¶©ì „</Link></li>
          <li className={location.pathname.startsWith("/usage") ? "active" : ""}><Link to="/usage">ì´ìš©í˜„í™©</Link></li>
          <li className={location.pathname.startsWith("/gift") ? "active" : ""}><Link to="/gift">ì„ ë¬¼í•˜ê¸°</Link></li>
          <li className={location.pathname.startsWith("/settings") ? "active" : ""}><Link to="/settings">ì„¤ì •</Link></li>
        </ul>
      </aside>
      <main className="main-content">
        <Routes>
          <Route path="/" element={<Dashboard />} />
          <Route path="/members" element={<MemberList members={members} setMembers={setMembers} />} />
          <Route path="/members/new" element={<MemberDetail members={members} onUpdate={handleAddMember} />} />
          <Route path="/members/:id" element={<MemberDetail members={members} onUpdate={handleUpdateMember} />} />
          <Route path="/gift" element={<GiftPage members={members} setMembers={setMembers} />} />
          <Route path="/charge" element={<PointCharge />} />
          <Route path="/settlement" element={<Settlement />} />
          <Route path="/settlement/:id" element={<SettlementDetail />} />
          <Route path="/usage" element={<UsageTable />} />
          <Route path="/settings" element={<Settings />} />
          <Route path="/settings/departments" element={<DepartmentSettings departments={departments} onAddDepartment={handleAddDepartment} />} />
        </Routes>
      </main>
    </div>
  );
}

// ì„¤ì • ë©”ì¸ í˜ì´ì§€
function Settings() {
  const navigate = useNavigate();
  
  // í˜„ì¬ ê´€ë¦¬ì ì •ë³´ (ì‹¤ì œë¡œëŠ” ë¡œê·¸ì¸ ì •ë³´ì—ì„œ ê°€ì ¸ì˜´)
  const adminInfo = {
    id: "admin@technoble.co.kr",
    name: "ê¹€ê´€ë¦¬ì",
    phone: "010-1234-5678",
    role: "ì‹œìŠ¤í…œ ê´€ë¦¬ì"
  };

  return (
    <div className="settings-page">
      <div className="settings-header">
        <h2>ì„¤ì •</h2>
      </div>

      <div className="settings-content">
        <div className="admin-info-section">
          <h3>ê´€ë¦¬ì ì •ë³´</h3>
          <div className="admin-info-card">
            <div className="info-item">
              <label>í˜„ì¬ ì•„ì´ë””</label>
              <span>{adminInfo.id}</span>
            </div>
            <div className="info-item">
              <label>ë‹´ë‹¹ì ì„±í•¨</label>
              <span>{adminInfo.name}</span>
            </div>
            <div className="info-item">
              <label>ì—°ë½ì²˜</label>
              <span>{adminInfo.phone}</span>
            </div>
            <div className="info-item">
              <label>ê¶Œí•œ</label>
              <span>{adminInfo.role}</span>
            </div>
          </div>
        </div>

        <div className="settings-menu-section">
          <h3>ì„¤ì • ë©”ë‰´</h3>
          <div className="settings-menu-grid">
            <div className="settings-menu-card" onClick={() => navigate("/settings/departments")}>
              <div className="menu-icon">ğŸ¢</div>
              <h4>ë¶€ì„œ ì„¤ì •</h4>
              <p>ë¶€ì„œ ë° íŒ€ ê´€ë¦¬</p>
              <div className="menu-arrow">â†’</div>
            </div>
            
            <div className="settings-menu-card disabled">
              <div className="menu-icon">ğŸ‘¥</div>
              <h4>ê¶Œí•œ ì„¤ì •</h4>
              <p>ì‚¬ìš©ì ê¶Œí•œ ê´€ë¦¬</p>
              <div className="menu-arrow">â†’</div>
            </div>
            
            <div className="settings-menu-card disabled">
              <div className="menu-icon">ğŸ””</div>
              <h4>ì•Œë¦¼ ì„¤ì •</h4>
              <p>ì‹œìŠ¤í…œ ì•Œë¦¼ ê´€ë¦¬</p>
              <div className="menu-arrow">â†’</div>
            </div>
            
            <div className="settings-menu-card disabled">
              <div className="menu-icon">ğŸ”’</div>
              <h4>ë³´ì•ˆ ì„¤ì •</h4>
              <p>ë¹„ë°€ë²ˆí˜¸ ì •ì±… ì„¤ì •</p>
              <div className="menu-arrow">â†’</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}

// ë¶€ì„œ ì„¤ì • í˜ì´ì§€
function DepartmentSettings({ departments, onAddDepartment }) {
  const navigate = useNavigate();
  const [showAddModal, setShowAddModal] = useState(false);
  const [newDepartment, setNewDepartment] = useState({
    companyName: "í…Œí¬ë…¸ë¸”",
    departmentName: "",
    teamName: ""
  });

  const handleAddDepartment = () => {
    setShowAddModal(true);
  };

  const handleSaveDepartment = () => {
    if (!newDepartment.departmentName || !newDepartment.teamName) {
      alert("ë¶€ì„œëª…ê³¼ íŒ€ëª…ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.");
      return;
    }
    
    onAddDepartment(newDepartment);
    setNewDepartment({
      companyName: "í…Œí¬ë…¸ë¸”",
      departmentName: "",
      teamName: ""
    });
    setShowAddModal(false);
    alert("ë¶€ì„œê°€ ì„±ê³µì ìœ¼ë¡œ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.");
  };

  const handleCloseModal = () => {
    setShowAddModal(false);
    setNewDepartment({
      companyName: "í…Œí¬ë…¸ë¸”",
      departmentName: "",
      teamName: ""
    });
  };

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setNewDepartment(prev => ({
      ...prev,
      [name]: value
    }));
  };

  return (
    <div className="department-settings-page">
      <div className="department-header">
        <div className="header-left">
          <button onClick={() => navigate("/settings")} className="back-btn">
            â† ì„¤ì •ìœ¼ë¡œ ëŒì•„ê°€ê¸°
          </button>
        </div>
        <div className="header-center">
          <h2>ë¶€ì„œ ì„¤ì •</h2>
        </div>
        <div className="header-right">
          <button className="add-dept-btn" onClick={handleAddDepartment}>
            + ë¶€ì„œ ë“±ë¡
          </button>
        </div>
      </div>

      <div className="department-content">
        <div className="department-list">
          <h3>ë¶€ì„œ ëª©ë¡</h3>
          <div className="department-table">
            <table>
              <thead>
                <tr>
                  <th>íšŒì‚¬ëª…</th>
                  <th>ë¶€ì„œëª…</th>
                  <th>íŒ€ëª…</th>
                  <th>ì „ì²´ëª…</th>
                </tr>
              </thead>
              <tbody>
                {departments.map((dept) => (
                  <tr key={dept.id}>
                    <td>{dept.companyName}</td>
                    <td>{dept.departmentName}</td>
                    <td>{dept.teamName}</td>
                    <td className="full-name">
                      {dept.companyName} {dept.departmentName} {dept.teamName}
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </div>
      </div>

      {/* ë¶€ì„œ ë“±ë¡ ëª¨ë‹¬ */}
      {showAddModal && (
        <div className="modal-overlay" onClick={handleCloseModal}>
          <div className="add-dept-modal" onClick={e => e.stopPropagation()}>
            <div className="modal-header">
              <h3>ë¶€ì„œ ë“±ë¡</h3>
              <button className="close-btn" onClick={handleCloseModal}>Ã—</button>
            </div>
            <div className="modal-content">
              <div className="form-group">
                <label>íšŒì‚¬ëª…</label>
                <input
                  type="text"
                  name="companyName"
                  value={newDepartment.companyName}
                  onChange={handleInputChange}
                  placeholder="íšŒì‚¬ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
                />
              </div>
              <div className="form-group">
                <label>ë¶€ì„œëª…</label>
                <input
                  type="text"
                  name="departmentName"
                  value={newDepartment.departmentName}
                  onChange={handleInputChange}
                  placeholder="ë¶€ì„œëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
                />
              </div>
              <div className="form-group">
                <label>íŒ€ëª…</label>
                <input
                  type="text"
                  name="teamName"
                  value={newDepartment.teamName}
                  onChange={handleInputChange}
                  placeholder="íŒ€ëª…ì„ ì…ë ¥í•˜ì„¸ìš”"
                />
              </div>
              <div className="preview-section">
                <label>ë“±ë¡ë  ë¶€ì„œëª…</label>
                <div className="preview-text">
                  {newDepartment.companyName} {newDepartment.departmentName} {newDepartment.teamName}
                </div>
              </div>
            </div>
            <div className="modal-footer">
              <button className="cancel-btn" onClick={handleCloseModal}>ì·¨ì†Œ</button>
              <button className="save-btn" onClick={handleSaveDepartment}>ë“±ë¡í•˜ê¸°</button>
            </div>
          </div>
        </div>
      )}
    </div>
  );
}

function App() {
  const [isLoggedIn, setIsLoggedIn] = useState(true); // ê°œë°œìš©ìœ¼ë¡œ trueë¡œ ì„¤ì •
  const [members, setMembers] = useState(initialMembers);

  // ì‹ ê·œ ë“±ë¡ ì‹œ ìƒì„¸í˜ì´ì§€ë¡œ ì´ë™
  const handleAddMember = (newMember) => {
    const newId = Math.max(...members.map(m => m.id)) + 1;
    setMembers(prev => [...prev, { ...newMember, id: newId }]);
  };

  // ìƒì„¸/ìˆ˜ì • ì €ì¥
  const handleUpdateMember = (updated) => {
    setMembers(prev => prev.map(m => m.id === updated.id ? updated : m));
  };

  return (
    <Router>
      <Routes>
        <Route path="/login" element={<LoginPage onLogin={() => setIsLoggedIn(true)} />} />
        <Route path="/*" element={isLoggedIn ? <AdminLayout members={members} setMembers={setMembers} handleAddMember={handleAddMember} handleUpdateMember={handleUpdateMember} /> : <Navigate to="/login" />} />
        
      </Routes>
    </Router>
  );
}

export default App;
